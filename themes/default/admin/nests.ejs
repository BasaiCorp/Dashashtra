<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nests & Eggs Management | Flaxy Nodes</title>
    <link rel="icon" type="image/png" href="<%= extra.faviconlink %>"/>
    
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b',
                        },
                        dark: {
                            base: '#0f0f12',
                            light: '#1a1a21',
                            lighter: '#24242e',
                            card: '#1a1a21'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            background-color: #0f0f12;
            color: #f5f5f7;
            font-family: 'Poppins', sans-serif;
        }
        
        .glass-card {
            background: rgba(26, 26, 31, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-primary {
            background-color: #6366f1;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e1e24;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3a3a43;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4a4a55;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold">Nests & Eggs Management</h1>
            <button type="button" class="btn-primary text-white font-medium" data-bs-toggle="modal" data-bs-target="#createNestModal">
                <i class="fas fa-plus mr-2"></i> Create New Nest
            </button>
        </div>
        
        <!-- Nests Section -->
        <div class="glass-card rounded-2xl p-6 mb-8 animate-fade-in">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold">Nests</h2>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left text-gray-400 text-sm border-b border-gray-700">
                            <th class="pb-3 font-medium">ID</th>
                            <th class="pb-3 font-medium">Name</th>
                            <th class="pb-3 font-medium">Description</th>
                            <th class="pb-3 font-medium">Eggs</th>
                            <th class="pb-3 font-medium">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% nests.forEach(function(nest) { %>
                            <tr class="border-b border-gray-700/50 hover:bg-dark-lighter/30 transition-colors duration-150">
                                <td class="py-4"><%= nest.id %></td>
                                <td class="py-4"><%= nest.name %></td>
                                <td class="py-4"><%= nest.description %></td>
                                <td class="py-4"><%= eggs[nest.id] ? eggs[nest.id].length : 0 %></td>
                                <td class="py-4">
                                    <div class="flex space-x-2">
                                        <button onclick="editNest('<%= nest.id %>')" class="p-2 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 transition-colors duration-200" title="Edit Nest">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteNest('<%= nest.id %>')" class="p-2 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors duration-200" title="Delete Nest">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <button onclick="showEggs('<%= nest.id %>')" class="p-2 rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20 transition-colors duration-200" title="View Eggs">
                                            <i class="fas fa-egg"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Eggs Section -->
        <div id="eggsSection" class="glass-card rounded-2xl p-6 mb-8 animate-fade-in" style="display: none;">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold">Eggs for Nest: <span id="currentNestName" class="text-primary-400"></span></h2>
                <button type="button" class="btn-primary text-white font-medium" onclick="showCreateEggModal()">
                    <i class="fas fa-plus mr-2"></i> Create New Egg
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left text-gray-400 text-sm border-b border-gray-700">
                            <th class="pb-3 font-medium">ID</th>
                            <th class="pb-3 font-medium">Name</th>
                            <th class="pb-3 font-medium">Description</th>
                            <th class="pb-3 font-medium">Docker Image</th>
                            <th class="pb-3 font-medium">Startup Command</th>
                            <th class="pb-3 font-medium">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="eggsTable">
                        <!-- Eggs will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create Nest Modal -->
    <div class="modal fade" id="createNestModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark-light border border-gray-700">
                <div class="modal-header border-b border-gray-700">
                    <h5 class="modal-title text-white">Create New Nest</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form action="/admin/nests" method="POST">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="nestName" class="form-label text-gray-300">Name</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="nestName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="nestDescription" class="form-label text-gray-300">Description</label>
                            <textarea class="form-control bg-dark-lighter border-gray-700 text-white" id="nestDescription" name="description" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer border-t border-gray-700">
                        <button type="button" class="btn btn-secondary bg-gray-700 text-white" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Nest</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Nest Modal -->
    <div class="modal fade" id="editNestModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark-light border border-gray-700">
                <div class="modal-header border-b border-gray-700">
                    <h5 class="modal-title text-white">Edit Nest</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="editNestForm" method="POST">
                    <div class="modal-body">
                        <input type="hidden" id="editNestId" name="id">
                        <div class="mb-3">
                            <label for="editNestName" class="form-label text-gray-300">Name</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="editNestName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="editNestDescription" class="form-label text-gray-300">Description</label>
                            <textarea class="form-control bg-dark-lighter border-gray-700 text-white" id="editNestDescription" name="description" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer border-t border-gray-700">
                        <button type="button" class="btn btn-secondary bg-gray-700 text-white" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Egg Modal -->
    <div class="modal fade" id="createEggModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark-light border border-gray-700">
                <div class="modal-header border-b border-gray-700">
                    <h5 class="modal-title text-white">Create New Egg</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="createEggForm" method="POST">
                    <div class="modal-body">
                        <input type="hidden" id="createEggNestId" name="nest_id">
                        <div class="mb-3">
                            <label for="eggName" class="form-label text-gray-300">Name</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="eggName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="eggDescription" class="form-label text-gray-300">Description</label>
                            <textarea class="form-control bg-dark-lighter border-gray-700 text-white" id="eggDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="dockerImage" class="form-label text-gray-300">Docker Image</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="dockerImage" name="docker_image" required>
                        </div>
                        <div class="mb-3">
                            <label for="startupCmd" class="form-label text-gray-300">Startup Command</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="startupCmd" name="startup" required>
                        </div>
                    </div>
                    <div class="modal-footer border-t border-gray-700">
                        <button type="button" class="btn btn-secondary bg-gray-700 text-white" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Egg</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Egg Modal -->
    <div class="modal fade" id="editEggModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark-light border border-gray-700">
                <div class="modal-header border-b border-gray-700">
                    <h5 class="modal-title text-white">Edit Egg</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="editEggForm" method="POST">
                    <div class="modal-body">
                        <input type="hidden" id="editEggNestId" name="nest_id">
                        <input type="hidden" id="editEggId" name="egg_id">
                        <div class="mb-3">
                            <label for="editEggName" class="form-label text-gray-300">Name</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="editEggName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="editEggDescription" class="form-label text-gray-300">Description</label>
                            <textarea class="form-control bg-dark-lighter border-gray-700 text-white" id="editEggDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editDockerImage" class="form-label text-gray-300">Docker Image</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="editDockerImage" name="docker_image" required>
                        </div>
                        <div class="mb-3">
                            <label for="editStartupCmd" class="form-label text-gray-300">Startup Command</label>
                            <input type="text" class="form-control bg-dark-lighter border-gray-700 text-white" id="editStartupCmd" name="startup" required>
                        </div>
                    </div>
                    <div class="modal-footer border-t border-gray-700">
                        <button type="button" class="btn btn-secondary bg-gray-700 text-white" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentNestId = null;

        function editNest(nestId) {
            const nest = nests.find(n => n.id === nestId);
            if (nest) {
                document.getElementById('editNestId').value = nest.id;
                document.getElementById('editNestName').value = nest.name;
                document.getElementById('editNestDescription').value = nest.description;
                document.getElementById('editNestForm').action = `/admin/nests/${nest.id}?_method=PUT`;
                new bootstrap.Modal(document.getElementById('editNestModal')).show();
            }
        }

        function deleteNest(nestId) {
            if (confirm('Are you sure you want to delete this nest? This will also delete all eggs in this nest.')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/admin/nests/${nestId}?_method=DELETE`;
                document.body.appendChild(form);
                form.submit();
            }
        }

        function showEggs(nestId) {
            currentNestId = nestId;
            const nest = nests.find(n => n.id === nestId);
            document.getElementById('currentNestName').textContent = nest.name;
            
            const tbody = document.querySelector('#eggsTable');
            tbody.innerHTML = '';
            
            if (eggs[nestId]) {
                eggs[nestId].forEach(egg => {
                    tbody.innerHTML += `
                        <tr class="border-b border-gray-700/50 hover:bg-dark-lighter/30 transition-colors duration-150">
                            <td class="py-4">${egg.id}</td>
                            <td class="py-4">${egg.name}</td>
                            <td class="py-4">${egg.description}</td>
                            <td class="py-4">${egg.docker_image}</td>
                            <td class="py-4">${egg.startup}</td>
                            <td class="py-4">
                                <div class="flex space-x-2">
                                    <button onclick="editEgg('${egg.id}')" class="p-2 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 transition-colors duration-200" title="Edit Egg">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteEgg('${egg.id}')" class="p-2 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors duration-200" title="Delete Egg">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
            
            document.getElementById('eggsSection').style.display = 'block';
        }

        function showCreateEggModal() {
            document.getElementById('createEggNestId').value = currentNestId;
            document.getElementById('createEggForm').action = `/admin/nests/${currentNestId}/eggs`;
            new bootstrap.Modal(document.getElementById('createEggModal')).show();
        }

        function editEgg(eggId) {
            const egg = eggs[currentNestId].find(e => e.id === eggId);
            if (egg) {
                document.getElementById('editEggNestId').value = currentNestId;
                document.getElementById('editEggId').value = egg.id;
                document.getElementById('editEggName').value = egg.name;
                document.getElementById('editEggDescription').value = egg.description;
                document.getElementById('editDockerImage').value = egg.docker_image;
                document.getElementById('editStartupCmd').value = egg.startup;
                document.getElementById('editEggForm').action = `/admin/nests/${currentNestId}/eggs/${egg.id}?_method=PUT`;
                new bootstrap.Modal(document.getElementById('editEggModal')).show();
            }
        }

        function deleteEgg(eggId) {
            if (confirm('Are you sure you want to delete this egg?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/admin/nests/${currentNestId}/eggs/${eggId}?_method=DELETE`;
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Make nests and eggs data available to JavaScript
        const nests = <%- JSON.stringify(nests) %>;
        const eggs = <%- JSON.stringify(eggs) %>;
    </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="<%= extra.servers.title.create %> - Create New Server">
	<meta name="theme-color" content="#0f0f12">
	
	<!-- Security Headers -->
	<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: 'unsafe-inline' 'unsafe-eval'; img-src 'self' https: data:; font-src 'self' https: data:;">
	<meta http-equiv="X-Content-Type-Options" content="nosniff">
	<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
	<meta http-equiv="X-XSS-Protection" content="1; mode=block">
	
	<title><%= extra.servers.title.create %></title>
	<link rel="icon" type="image/png" href="./assets/img/FlaxyNodes_logo.gif"/>
	
	<!-- Fonts and Icons -->
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	
	<!-- Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			darkMode: 'class',
			theme: {
				extend: {
					fontFamily: {
						sans: ['Poppins', 'sans-serif'],
					},
					colors: {
						primary: {
							50: '#eef2ff',
							100: '#e0e7ff',
							200: '#c7d2fe',
							300: '#a5b4fc',
							400: '#818cf8',
							500: '#6366f1',
							600: '#4f46e5',
							700: '#4338ca',
							800: '#3730a3',
							900: '#312e81',
							950: '#1e1b4b',
						},
						dark: {
							base: '#0f0f12',
							light: '#1a1a21',
							lighter: '#24242e',
							card: '#1a1a21'
						}
					},
					animation: {
						'fade-in': 'fadeIn 0.5s ease-in-out',
						'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
						'float': 'float 3s ease-in-out infinite',
					},
					keyframes: {
						fadeIn: {
							'0%': { opacity: '0' },
							'100%': { opacity: '1' },
						},
						float: {
							'0%, 100%': { transform: 'translateY(0)' },
							'50%': { transform: 'translateY(-10px)' },
						}
					},
					boxShadow: {
						'glow': '0 0 15px rgba(99, 102, 241, 0.5)',
						'card': '0 8px 24px rgba(0, 0, 0, 0.12)',
					}
				}
			}
		}
	</script>
	
	<style>
		body {
			background-color: #0f0f12;
			color: #f5f5f7;
			font-family: 'Poppins', sans-serif;
		}
		
		/* Custom scrollbar */
		::-webkit-scrollbar {
			width: 8px;
			height: 8px;
		}
		
		::-webkit-scrollbar-track {
			background: #1e1e24;
		}
		
		::-webkit-scrollbar-thumb {
			background: #3a3a43;
			border-radius: 4px;
		}
		
		::-webkit-scrollbar-thumb:hover {
			background: #4a4a55;
		}
		
		/* Custom styles */
		.sidebar {
			background-color: #161618;
			border-right: 1px solid #2d2d35;
		}
		
		.main-content {
			background-color: #0f0f12;
		}
		
		.bg-dark-card {
			background-color: #1a1a1f;
		}
		
		.bg-dark-lighter {
			background-color: #202026;
		}
		
		.menu-item.active {
			background-color: rgba(99, 102, 241, 0.1);
			color: #fff;
		}
		
		.menu-item.active i {
			color: #6366f1;
		}
		
		.glass-card {
			background: rgba(26, 26, 31, 0.7);
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
		}
		
		.btn-primary {
			background-color: #6366f1;
			border-radius: 0.5rem;
			padding: 0.5rem 1rem;
			transition: all 0.3s ease;
		}
		
		.btn-primary:hover {
			background-color: #4f46e5;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
		}
		
		.gradient-border {
			position: relative;
			border-radius: 0.75rem;
			overflow: hidden;
		}
		
		.gradient-border::before {
			content: "";
			position: absolute;
			inset: 0;
			border-radius: 0.75rem;
			padding: 1px;
			background: linear-gradient(to right, #6366f1, #8b5cf6);
			-webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
			mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
			-webkit-mask-composite: xor;
			mask-composite: exclude;
			pointer-events: none;
		}
		
		/* Form Styling */
		.form-input {
			background-color: #1a1a21;
			border: 1px solid #2d2d35;
			color: #f5f5f7;
			transition: all 0.3s ease;
			border-radius: 0.5rem;
			padding: 0.75rem 1rem;
		}
		
		.form-input:focus {
			border-color: #6366f1;
			box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
			outline: none;
		}
		
		.form-label {
			color: #a1a1aa;
			font-weight: 500;
			margin-bottom: 0.5rem;
			display: block;
		}
		
		.form-helper {
			color: #71717a;
			font-size: 0.875rem;
			margin-top: 0.25rem;
		}
		
		.form-error {
			color: #ef4444;
			font-size: 0.875rem;
			margin-top: 0.25rem;
		}
		
		/* Resource progress bars */
		.progress-bar {
			height: 8px;
			border-radius: 4px;
			background-color: #2d2d35;
			overflow: hidden;
		}
		
		.progress-bar-fill {
			height: 100%;
			border-radius: 4px;
			transition: width 0.5s ease;
		}
		
		.progress-bar-fill.ram {
			background: linear-gradient(to right, #6366f1, #8b5cf6);
		}
		
		.progress-bar-fill.disk {
			background: linear-gradient(to right, #10b981, #34d399);
		}
		
		.progress-bar-fill.cpu {
			background: linear-gradient(to right, #f59e0b, #fbbf24);
		}
		
		.progress-bar-fill.servers {
			background: linear-gradient(to right, #ec4899, #f43f5e);
		}
		
		/* Mobile responsiveness */
		@media (max-width: 640px) {
			.stat-card {
				padding: 1rem;
			}
		}
	</style>
</head>
<body class="min-h-screen">
	<!-- Calculate server resources -->
	<%
		let ram = 0;
		let disk = 0;
		let cpu = 0;
		let servers = 0;
		
		if (pterodactyl && pterodactyl.relationships && pterodactyl.relationships.servers && pterodactyl.relationships.servers.data) {
			servers = pterodactyl.relationships.servers.data.length;
			
			for (let i = 0, len = pterodactyl.relationships.servers.data.length; i < len; i++) {
				ram = ram + (typeof pterodactyl.relationships.servers.data[i].attributes.limits.memory == "number" ? pterodactyl.relationships.servers.data[i].attributes.limits.memory : 0);
				disk = disk + (typeof pterodactyl.relationships.servers.data[i].attributes.limits.disk == "number" ? pterodactyl.relationships.servers.data[i].attributes.limits.disk : 0);
				cpu = cpu + (typeof pterodactyl.relationships.servers.data[i].attributes.limits.cpu == "number" ? pterodactyl.relationships.servers.data[i].attributes.limits.cpu : 0);
			}
		}
		
		const userData = {
			id: userinfo.id,
			username: userinfo.username || userinfo.email.split('@')[0],
			email: userinfo.email,
			isAdmin: typeof req.session !== 'undefined' ? req.session.isAdmin : false
		};
		
		const packageData = typeof packages !== 'undefined' ? packages : {
			ram: 0,
			disk: 0,
			cpu: 0,
			servers: 0
		};
		
		// Calculate total resources (package + extra)
		const extraData = typeof extraresources !== 'undefined' ? extraresources : {
			ram: 0,
			disk: 0,
			cpu: 0,
			servers: 0
		};
		
		const totalRam = packageData.ram + extraData.ram;
		const totalDisk = packageData.disk + extraData.disk;
		const totalCpu = packageData.cpu + extraData.cpu;
		const totalServers = packageData.servers + extraData.servers;
		
		// Available resources
		const availableRam = totalRam - ram;
		const availableDisk = totalDisk - disk;
		const availableCpu = totalCpu - cpu;
		const availableServers = totalServers - servers;
	%>

	<!-- Navbar -->
	<nav class="navbar fixed w-full h-16 z-50 px-4 py-2.5 flex items-center justify-between bg-dark-base/80 backdrop-blur-lg border-b border-gray-800">
		<!-- Left side - Logo and Brand -->
		<div class="flex items-center">
			<a href="/" class="flex items-center group">
				<div class="h-10 w-10 mr-3 rounded-full overflow-hidden transition-all duration-300 group-hover:shadow-glow">
					<img src="/assets/img/FlaxyNodes_logo.gif" class="h-full w-full object-cover" alt="Flaxy Nodes Logo">
				</div>
				<div class="flex flex-col">
					<span class="self-center text-xl font-bold text-white">Flaxy Nodes</span>
					<span class="text-xs text-indigo-300">Premium Game Hosting</span>
				</div>
			</a>
		</div>

		<!-- Center - Search Bar -->
		<div class="hidden md:flex items-center flex-1 max-w-xl mx-8">
			<div class="relative w-full">
				<input type="text" placeholder="Search servers..." class="w-full px-4 py-2 bg-dark-lighter rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500">
				<button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white">
					<i class="fas fa-search"></i>
				</button>
			</div>
		</div>

		<!-- Right side - User Menu and Notifications -->
		<div class="flex items-center gap-4">
			<!-- Notifications -->
			<div class="relative">
				<button class="p-2 text-gray-400 hover:text-white transition-colors duration-200">
					<i class="fas fa-bell"></i>
					<span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
				</button>
			</div>

			<!-- User Profile Dropdown -->
			<div class="relative inline-block">
				<button id="dropdownBtn" class="flex items-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-dark-lighter hover:bg-primary-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50">
					<div class="w-8 h-8 rounded-full bg-primary-500/20 flex items-center justify-center mr-2">
						<i class="fas fa-user text-primary-400"></i>
					</div>
					<span class="mr-2"><%= userData.username %></span>
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
					</svg>
				</button>
				<div id="dropdownMenu" class="hidden absolute right-0 mt-2 w-64 bg-dark-lighter rounded-lg shadow-lg overflow-hidden z-50 border border-gray-700">
					<div class="p-4 border-b border-gray-700">
						<div class="flex items-center">
							<div class="w-10 h-10 rounded-full bg-primary-500/20 flex items-center justify-center mr-3">
								<i class="fas fa-user text-primary-400"></i>
							</div>
							<div>
								<p class="text-sm font-medium text-white"><%= userData.username %></p>
								<p class="text-xs text-gray-400"><%= userData.email %></p>
							</div>
						</div>
					</div>
					<ul class="py-1 text-sm text-gray-200">
						<li>
							<a href="/settings" class="flex items-center px-4 py-2 hover:bg-dark-base hover:text-primary-400 transition-colors duration-200">
								<i class="fas fa-cog mr-2"></i> Settings
							</a>
						</li>
						<li>
							<a href="/profile" class="flex items-center px-4 py-2 hover:bg-dark-base hover:text-primary-400 transition-colors duration-200">
								<i class="fas fa-user-circle mr-2"></i> Profile
							</a>
						</li>
						<% if (userData.isAdmin) { %>
						<li>
							<a href="/admin" class="flex items-center px-4 py-2 hover:bg-dark-base hover:text-primary-400 transition-colors duration-200">
								<i class="fas fa-shield-alt mr-2"></i> Admin Panel
							</a>
						</li>
						<% } %>
						<li class="border-t border-gray-700 mt-1">
							<a href="/auth/logout" class="flex items-center px-4 py-2 hover:bg-dark-base text-red-400 hover:text-red-300 transition-colors duration-200">
								<i class="fas fa-sign-out-alt mr-2"></i> Logout
							</a>
						</li>
					</ul>
				</div>
			</div>

			<!-- Mobile Menu Button -->
			<button id="mobileMenuBtn" class="md:hidden p-2 text-gray-400 hover:text-white transition-colors duration-200">
				<i class="fas fa-bars"></i>
			</button>
		</div>
	</nav>

	<!-- Mobile Search Bar -->
	<div id="mobileSearch" class="md:hidden fixed top-16 left-0 right-0 p-4 bg-dark-base border-b border-gray-800 z-40 hidden">
		<div class="relative">
			<input type="text" placeholder="Search servers..." class="w-full px-4 py-2 bg-dark-lighter rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500">
			<button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white">
				<i class="fas fa-search"></i>
			</button>
		</div>
	</div>

	<div class="flex h-screen pt-16">
		<!-- Sidebar -->
		<aside id="sidebar" class="fixed left-0 top-16 h-full z-10 w-64 transition-transform -translate-x-full sm:translate-x-0">
			<div class="h-full px-3 pb-4 overflow-y-auto sidebar">
				<ul class="space-y-1 pt-4 font-medium">
					<li>
						<a href="/dashboard" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-tachometer-alt w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Dashboard</span>
						</a>
					</li>
					<li>
						<a href="/servers" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-server w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Servers</span>
						</a>
					</li>
					<li>
						<a href="/store" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-shopping-cart w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Store</span>
						</a>
					</li>
					<li>
						<a href="/afk" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-coins w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">AFK Page</span>
						</a>
					</li>
					<li>
						<a href="/redeem" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-gift w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Redeem</span>
						</a>
					</li>
					<li>
						<a href="/earn" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-gem w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Earn</span>
						</a>
					</li>
					<li>
						<a href="/leaderboard" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-trophy w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Leaderboard</span>
						</a>
					</li>
					<li>
						<a href="/settings" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-cog w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Settings</span>
						</a>
					</li>
					<li>
						<a href="<%= settings.pterodactyl.domain %>" target="_blank" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-external-link-alt w-5 h-5 text-gray-400 transition duration-75 group-hover:text-primary-400"></i>
							<span class="ml-3">Panel</span>
						</a>
					</li>
					<% if (userData.isAdmin) { %>
					<li class="mt-6 pt-6 border-t border-gray-700">
						<a href="/admin" class="menu-item flex items-center p-3 text-gray-300 rounded-lg hover:text-white">
							<i class="fas fa-shield-alt w-5 h-5 text-red-400 transition duration-75 group-hover:text-red-300"></i>
							<span class="ml-3">Admin Panel</span>
						</a>
					</li>
					<% } %>
				</ul>
			</div>
		</aside>

		<!-- Main Content -->
		<div class="p-4 sm:ml-64 pt-5 w-full main-content">
			<div class="p-4">
				<!-- Welcome Message -->
				<div class="mb-8 glass-card p-6 rounded-xl animate-fade-in">
					<h1 class="text-3xl font-bold mb-2">Create New Server</h1>
					<p class="text-gray-400">Configure and deploy your new game server with the available resources.</p>
				</div>

				<!-- Resource Stats -->
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 animate-slide-up" style="animation-delay: 0.1s;">
					<!-- RAM Card -->
					<div class="gradient-border">
						<div class="stat-card h-full bg-dark-card rounded-lg p-6">
							<div class="flex items-center justify-between mb-4">
								<div class="flex items-center">
									<div class="w-12 h-12 rounded-lg bg-indigo-500/20 flex items-center justify-center mr-3">
										<i class="fas fa-memory text-indigo-400 text-xl"></i>
									</div>
									<div class="ml-4">
										<h3 class="text-lg font-semibold text-white">Available RAM</h3>
										<p class="text-gray-400 text-sm">Memory Resources</p>
									</div>
								</div>
								<span class="text-xl font-bold text-white"><%= availableRam %> <span class="text-gray-400 text-sm">/ <%= totalRam %> MB</span></span>
							</div>
							<div class="progress-bar">
								<div class="progress-bar-fill ram" style="width: <%= ((ram / totalRam) * 100).toFixed(2) + '%' %>"></div>
							</div>
						</div>
					</div>
					
					<!-- Disk Card -->
					<div class="gradient-border">
						<div class="stat-card h-full bg-dark-card rounded-lg p-6">
							<div class="flex items-center justify-between mb-4">
								<div class="flex items-center">
									<div class="w-12 h-12 rounded-lg bg-green-500/20 flex items-center justify-center mr-3">
										<i class="fas fa-hdd text-green-400 text-xl"></i>
									</div>
									<div class="ml-4">
										<h3 class="text-lg font-semibold text-white">Available Disk</h3>
										<p class="text-gray-400 text-sm">Storage Resources</p>
									</div>
								</div>
								<span class="text-xl font-bold text-white"><%= availableDisk %> <span class="text-gray-400 text-sm">/ <%= totalDisk %> MB</span></span>
							</div>
							<div class="progress-bar">
								<div class="progress-bar-fill disk" style="width: <%= ((disk / totalDisk) * 100).toFixed(2) + '%' %>"></div>
							</div>
						</div>
					</div>
					
					<!-- CPU Card -->
					<div class="gradient-border">
						<div class="stat-card h-full bg-dark-card rounded-lg p-6">
							<div class="flex items-center justify-between mb-4">
								<div class="flex items-center">
									<div class="w-12 h-12 rounded-lg bg-amber-500/20 flex items-center justify-center mr-3">
										<i class="fas fa-microchip text-amber-400 text-xl"></i>
									</div>
									<div class="ml-4">
										<h3 class="text-lg font-semibold text-white">Available CPU</h3>
										<p class="text-gray-400 text-sm">Processor Resources</p>
									</div>
								</div>
								<span class="text-xl font-bold text-white"><%= availableCpu %> <span class="text-gray-400 text-sm">/ <%= totalCpu %>%</span></span>
							</div>
							<div class="progress-bar">
								<div class="progress-bar-fill cpu" style="width: <%= ((cpu / totalCpu) * 100).toFixed(2) + '%' %>"></div>
							</div>
						</div>
					</div>
					
					<!-- Servers Card -->
					<div class="gradient-border">
						<div class="stat-card h-full bg-dark-card rounded-lg p-6">
							<div class="flex items-center justify-between mb-4">
								<div class="flex items-center">
									<div class="w-12 h-12 rounded-lg bg-purple-500/20 flex items-center justify-center mr-3">
										<i class="fas fa-server text-purple-400 text-xl"></i>
									</div>
									<div class="ml-4">
										<h3 class="text-lg font-semibold text-white">Available Servers</h3>
										<p class="text-gray-400 text-sm">Server Slots</p>
									</div>
								</div>
								<span class="text-xl font-bold text-white"><%= availableServers %> <span class="text-gray-400 text-sm">/ <%= totalServers %></span></span>
							</div>
							<div class="progress-bar">
								<div class="progress-bar-fill servers" style="width: <%= ((servers / totalServers) * 100).toFixed(2) + '%' %>"></div>
							</div>
						</div>
					</div>
				</div>

				<!-- Error Messages -->
				<% if (req.query.err) { %>
					<div class="bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-6">
						<div class="flex items-start">
							<div class="flex-shrink-0">
								<i class="fas fa-exclamation-triangle text-red-400 text-xl"></i>
							</div>
							<div class="ml-3">
								<h3 class="text-lg font-medium text-red-400">
									<% if (req.query.err === 'RAMEXCEED') { %>
										Not Enough RAM
									<% } else if (req.query.err === 'DISKEXCEED') { %>
										Not Enough Disk Space
									<% } else if (req.query.err === 'CPUEXCEED') { %>
										Not Enough CPU Resources
									<% } else if (req.query.err === 'SERVEREXCEED') { %>
										Server Limit Reached
									<% } else if (req.query.err === 'MISSINGVARIABLE') { %>
										Missing Required Information
									<% } else if (req.query.err === 'NOTENOUGHRAM') { %>
										Minimum RAM Requirement Not Met
									<% } else if (req.query.err === 'NOTENOUGHDISK') { %>
										Minimum Disk Requirement Not Met
									<% } else if (req.query.err === 'NOTENOUGHCPU') { %>
										Minimum CPU Requirement Not Met
									<% } else if (req.query.err === 'CONNECTIONERROR') { %>
										Connection Error
									<% } else if (req.query.err === 'NOALLOCATIONS') { %>
										No Available Allocations
									<% } else if (req.query.err === 'INVALIDLOCATION') { %>
										Invalid Location Selected
									<% } else { %>
										Error Creating Server
									<% } %>
								</h3>
								<div class="mt-2 text-sm text-gray-200">
									<% if (req.query.err === 'RAMEXCEED') { %>
										You don't have enough RAM available to create this server. You requested <%= req.query.err_ram %> MB but you only have <%= availableRam %> MB available.
									<% } else if (req.query.err === 'DISKEXCEED') { %>
										You don't have enough disk space available to create this server. You requested <%= req.query.err_disk %> MB but you only have <%= availableDisk %> MB available.
									<% } else if (req.query.err === 'CPUEXCEED') { %>
										You don't have enough CPU resources available to create this server. You requested <%= req.query.err_cpu %>% but you only have <%= availableCpu %>% available.
									<% } else if (req.query.err === 'SERVEREXCEED') { %>
										You have reached your maximum server limit. You need to upgrade your plan or purchase more server slots from the store to create additional servers.
									<% } else if (req.query.err === 'MISSINGVARIABLE') { %>
										Please fill in all required fields to create a server.
									<% } else if (req.query.err === 'NOTENOUGHRAM') { %>
										The minimum RAM requirement is 1024 MB. Please allocate at least 1024 MB of RAM to your server.
									<% } else if (req.query.err === 'NOTENOUGHDISK') { %>
										The minimum disk requirement is 1024 MB. Please allocate at least 1024 MB of disk space to your server.
									<% } else if (req.query.err === 'NOTENOUGHCPU') { %>
										The minimum CPU requirement is 10%. Please allocate at least 10% CPU to your server.
									<% } else if (req.query.err === 'CONNECTIONERROR') { %>
										Could not establish a connection to the game server node. This usually indicates a network issue between the panel and the node. Please try again in a few minutes or contact an administrator if the problem persists.
									<% } else if (req.query.err === 'NOALLOCATIONS') { %>
										The server could not be created because there are no available allocations (IP addresses and ports) on the selected node. Please try a different location or contact an administrator to add more allocations.
									<% } else if (req.query.err === 'INVALIDLOCATION') { %>
										The selected location is not valid or is not available for your account. Please choose a different location and try again.
									<% } else { %>
										An unexpected error occurred while trying to create your server. Please try again or contact support if the problem persists.
									<% } %>
								</div>
							</div>
						</div>
					</div>
				<% } %>

				<!-- Create Server Form -->
				<div class="glass-card rounded-xl border border-gray-700 p-6 mb-8">
					<form action="/api/servers/create" method="POST" id="createServerForm">
						<!-- Server Name -->
						<div>
							<label class="form-label">Server Name</label>
							<input type="text" name="name" class="form-input w-full" placeholder="Enter server name" required>
							<p class="form-helper">Choose a unique name for your server</p>
						</div>

						<!-- Server Description -->
						<div>
							<label class="form-label">Server Description</label>
							<textarea name="description" class="form-input w-full" rows="3" placeholder="Enter server description"></textarea>
							<p class="form-helper">Brief description of your server's purpose</p>
						</div>

						<!-- Server Type -->
						<div>
							<label class="form-label">Server Type</label>
							<select name="egg" class="form-input w-full" required>
								<option value="">Select server type</option>
								<% if (typeof nests !== 'undefined' && nests.length > 0) { %>
									<% nests.forEach(nest => { %>
										<optgroup label="<%= nest.name %>">
											<% if (typeof eggs !== 'undefined' && eggs[nest.id]) { %>
												<% eggs[nest.id].forEach(egg => { %>
													<option value="<%= egg.id %>" data-nest="<%= nest.id %>"><%= egg.name %></option>
												<% }); %>
											<% } %>
										</optgroup>
									<% }); %>
								<% } else { %>
									<option value="1">Default Server</option>
								<% } %>
							</select>
							<p class="form-helper">Choose the game type for your server</p>
						</div>

						<!-- Egg-specific Variables -->
						<div id="eggVariables" class="mb-6 p-4 border border-gray-700/50 rounded-lg hidden">
							<h3 class="text-lg font-semibold mb-4">Server Configuration</h3>
							<div id="variableContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<!-- Variables will be added here dynamically -->
							</div>
						</div>

						<!-- Resource Allocation -->
						<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
							<div>
								<label class="form-label">RAM (MB)</label>
								<input type="number" name="ram" class="form-input w-full" min="512" max="<%= availableRam %>" value="1024" required>
								<p class="form-helper">Available: <%= availableRam %> MB</p>
							</div>
							<div>
								<label class="form-label">Disk (MB)</label>
								<input type="number" name="disk" class="form-input w-full" min="1024" max="<%= availableDisk %>" value="2048" required>
								<p class="form-helper">Available: <%= availableDisk %> MB</p>
							</div>
							<div>
								<label class="form-label">CPU (%)</label>
								<input type="number" name="cpu" class="form-input w-full" min="50" max="<%= availableCpu %>" value="100" required>
								<p class="form-helper">Available: <%= availableCpu %>%</p>
							</div>
						</div>

						<!-- Server Location -->
						<div>
							<label class="form-label">Server Location</label>
							<select name="location" class="form-input w-full" required>
								<option value="">Select location</option>
								<% if (typeof locations !== 'undefined' && locations.length > 0) { %>
									<% locations.forEach(location => { %>
										<% 
											// Skip the Germany location
											const locationName = location.short ? location.short.toLowerCase() : '';
											const locationLong = location.long ? location.long.toLowerCase() : '';
											const isGermany = locationName.includes('germany') || locationLong.includes('germany') || 
												locationName.includes('german') || locationLong.includes('german');
											
											if (!isGermany) { 
										%>
											<option value="<%= location.id %>"><%= location.short %><% if (location.long) { %> - <%= location.long %><% } %></option>
										<% } %>
									<% }); %>
								<% } else { %>
									<option value="1">Default Location</option>
								<% } %>
							</select>
							<p class="form-helper">Choose the region where your server will be hosted</p>
						</div>

						<!-- Submit Button -->
						<div class="flex justify-end mt-6">
							<button type="submit" class="btn-primary inline-flex items-center px-6 py-2 rounded-lg text-white font-medium">
								<i class="fas fa-plus mr-2"></i>
								Create Server
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer class="mt-auto py-6 border-t border-gray-800">
		<div class="container mx-auto px-4">
			<div class="flex flex-col md:flex-row justify-between items-center">
				<div class="mb-4 md:mb-0">
					<div class="flex items-center">
						<img src="<%= settings.logo %>" alt="Logo" class="h-8 mr-3">
						<span class="text-lg font-semibold text-white"><%= settings.name %></span>
					</div>
					<p class="text-gray-400 text-sm mt-2"> 2024 <%= settings.name %>. All rights reserved.</p>
				</div>
				
				<div class="flex space-x-6">
					<a href="/terms" class="text-gray-400 hover:text-white transition-colors duration-200">Terms</a>
					<a href="/privacy" class="text-gray-400 hover:text-white transition-colors duration-200">Privacy</a>
					<a href="/contact" class="text-gray-400 hover:text-white transition-colors duration-200">Contact</a>
					<a href="https://discord.gg/<%= settings.discord.id %>" target="_blank" class="text-gray-400 hover:text-white transition-colors duration-200">
						<i class="fab fa-discord mr-1"></i> Discord
					</a>
				</div>
			</div>
		</div>
	</footer>

	<script>
		// Mobile menu toggle
		const toggleSidebar = document.getElementById('toggleSidebar');
		const sidebar = document.getElementById('sidebar');
		const sidebarIcon = document.getElementById('sidebarIcon');
		
		toggleSidebar.addEventListener('click', () => {
			sidebar.classList.toggle('-translate-x-full');
			
			// Toggle icon between bars and times
			if (sidebar.classList.contains('-translate-x-full')) {
				sidebarIcon.classList.remove('fa-times');
				sidebarIcon.classList.add('fa-bars');
			} else {
				sidebarIcon.classList.remove('fa-bars');
				sidebarIcon.classList.add('fa-times');
			}
		});
		
		// Close sidebar when clicking outside on mobile
		document.addEventListener('click', (e) => {
			const isClickInsideSidebar = sidebar.contains(e.target);
			const isClickOnToggleButton = toggleSidebar.contains(e.target);
			
			if (!isClickInsideSidebar && !isClickOnToggleButton && window.innerWidth < 640 && !sidebar.classList.contains('-translate-x-full')) {
				sidebar.classList.add('-translate-x-full');
				sidebarIcon.classList.remove('fa-times');
				sidebarIcon.classList.add('fa-bars');
			}
		});
		
		// Highlight active menu item
		document.addEventListener('DOMContentLoaded', () => {
			const currentPath = window.location.pathname;
			const menuItems = document.querySelectorAll('.menu-item');
			
			menuItems.forEach(item => {
				const href = item.getAttribute('href');
				if (href === currentPath) {
					item.classList.add('active');
				}
			});
		});

		// Dropdown menu functionality
		const dropdownBtn = document.getElementById('dropdownBtn');
		const dropdownMenu = document.getElementById('dropdownMenu');
		const mobileMenuBtn = document.getElementById('mobileMenuBtn');
		const mobileSearch = document.getElementById('mobileSearch');

		// Toggle dropdown menu
		dropdownBtn.addEventListener('click', (e) => {
			e.stopPropagation();
			dropdownMenu.classList.toggle('hidden');
		});

		// Close dropdown when clicking outside
		document.addEventListener('click', (e) => {
			if (!dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
				dropdownMenu.classList.add('hidden');
			}
		});

		// Toggle mobile search
		mobileMenuBtn.addEventListener('click', () => {
			mobileSearch.classList.toggle('hidden');
		});

		// Close mobile search when clicking outside
		document.addEventListener('click', (e) => {
			if (!mobileMenuBtn.contains(e.target) && !mobileSearch.contains(e.target)) {
				mobileSearch.classList.add('hidden');
			}
		});

		// Dynamic egg variables handling
		document.addEventListener('DOMContentLoaded', () => {
			const eggSelect = document.querySelector('select[name="egg"]');
			const eggVariables = document.getElementById('eggVariables');
			const variableContainer = document.getElementById('variableContainer');

			// Load egg variables when egg type is selected
			eggSelect.addEventListener('change', async () => {
				const eggId = eggSelect.value;
				if (!eggId) {
					eggVariables.classList.add('hidden');
					return;
				}

				// Clear previous variables
				variableContainer.innerHTML = '';

				try {
					// Load egg variables from cache
					await loadEggVariables(eggId);
				} catch (error) {
					console.error('Error loading egg variables:', error);
				}
			});

			async function loadEggVariables(eggId) {
				// Hardcoded egg variables for common eggs
				const eggVariableMap = {
					// Vanilla Minecraft (ID 5)
					'5': [
						{
							name: 'Server Jar File',
							description: 'The name of the server jarfile to run the server with.',
							env_variable: 'SERVER_JARFILE',
							default_value: 'server.jar'
						},
						{
							name: 'Minecraft Version',
							description: 'The version of Minecraft Vanilla to install. Use "latest" for the latest version.',
							env_variable: 'VANILLA_VERSION',
							default_value: 'latest'
						}
					],
					// SpongeVanilla (ID 4)
					'4': [
						{
							name: 'Sponge Version',
							description: 'The version of SpongeVanilla to download and use.',
							env_variable: 'SPONGE_VERSION',
							default_value: '1.12.2-7.3.0'
						},
						{
							name: 'Server Jar File',
							description: 'The name of the Jarfile to use when running SpongeVanilla.',
							env_variable: 'SERVER_JARFILE',
							default_value: 'server.jar'
						}
					],
					// Paper (ID 2)
					'2': [
						{
							name: 'Minecraft Version',
							description: 'The version of minecraft to download. Leave at latest for the latest version.',
							env_variable: 'MINECRAFT_VERSION',
							default_value: 'latest'
						},
						{
							name: 'Server Jar File',
							description: 'The name of the server jarfile to run the server with.',
							env_variable: 'SERVER_JARFILE',
							default_value: 'server.jar'
						},
						{
							name: 'Build Number',
							description: 'The build number for the paper release. Leave at latest for the latest version.',
							env_variable: 'BUILD_NUMBER',
							default_value: 'latest'
						}
					]
				};

				// Check if we have hardcoded variables for this egg
				if (eggVariableMap[eggId]) {
					// Show the variables section
					eggVariables.classList.remove('hidden');

					// Add input fields for each variable
					eggVariableMap[eggId].forEach(variable => {
						const fieldId = `env_${variable.env_variable.toLowerCase()}`;
						const fieldName = variable.env_variable.toLowerCase();
						
						const variableField = document.createElement('div');
						variableField.innerHTML = `
							<label class="form-label">${variable.name}</label>
							<input type="text" id="${fieldId}" name="${fieldName}" class="form-input w-full" 
								placeholder="${variable.description}" value="${variable.default_value}" required>
							<p class="form-helper">${variable.description}</p>
						`;
						
						variableContainer.appendChild(variableField);
					});
				} else {
					// No variables, hide the section
					eggVariables.classList.add('hidden');
				}
			}
		});
	</script>
</body>
</html>